<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ระบบเช็คชื่อกิจกรรมหน้าเสาธง (Google Sheets Edition)</title>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS (xlsx) -->
  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
    * { font-family: 'Sarabun', sans-serif; }
    :root {
      --primary-green: #2E8B57;
      --secondary-pink: #FF69B4;
      --light-green: #98FB98;
      --light-pink: #FFC0CB;
    }
    .btn-primary { background-color: var(--primary-green); color: white; transition: all 0.3s; }
    .btn-primary:hover { background-color: #1a6b3d; }
    .btn-secondary { background-color: var(--secondary-pink); color: white; transition: all 0.3s; }
    .btn-secondary:hover { background-color: #e05a9b; }
    .bg-primary-light { background-color: var(--light-green); }
    .bg-secondary-light { background-color: var(--light-pink); }
    .border-primary { border-color: var(--primary-green); }
    .text-primary { color: var(--primary-green); }
    .text-secondary { color: var(--secondary-pink); }
    .status-present { background-color: #98FB98; }
    .status-absent  { background-color: #FFA07A; }
    .status-late    { background-color: #FFFF99; }
    .status-sick    { background-color: #ADD8E6; }
    .status-leave   { background-color: #DDA0DD; }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .slide-in { animation: slideIn 0.3s ease-in; }
    @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="root"></div>

  <!-- ========= API Helper (Replace WEB_APP_URL!) ========= -->
  <script>
    // *** สำคัญมาก: ใส่ URL Web App ของ Google Apps Script ตรงนี้ ***
    // ตัวอย่าง: const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx.../exec";
    const WEB_APP_URL = "PUT_YOUR_WEB_APP_URL_HERE";

    async function api(action, payload = {}) {
      if (!WEB_APP_URL || WEB_APP_URL.includes("PUT_YOUR_WEB_APP_URL_HERE")) {
        throw new Error("กรุณาตั้งค่า WEB_APP_URL ให้ถูกต้องก่อนใช้งาน");
      }
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action, ...payload })
      });
      const json = await res.json();
      if (!json.ok) throw new Error(json.error || "API error");
      return json.data !== undefined ? json.data : json;
    }
  </script>

  <script type="text/babel">
    // ====== Constants ======
    const ROOMS = [
      { id: 'k2', name: 'อนุบาล 2' },
      { id: 'k3', name: 'อนุบาล 3' },
      { id: 'p1', name: 'ประถมศึกษาปีที่ 1' },
      { id: 'p2', name: 'ประถมศึกษาปีที่ 2' },
      { id: 'p3', name: 'ประถมศึกษาปีที่ 3' },
      { id: 'p4', name: 'ประถมศึกษาปีที่ 4' },
      { id: 'p5', name: 'ประถมศึกษาปีที่ 5' },
      { id: 'p6', name: 'ประถมศึกษาปีที่ 6' },
      { id: 'm1', name: 'มัธยมศึกษาปีที่ 1' },
      { id: 'm2', name: 'มัธยมศึกษาปีที่ 2' },
      { id: 'm3', name: 'มัธยมศึกษาปีที่ 3' },
    ];

    const STATUS_OPTIONS = [
      { value: 'มา', label: 'มา', color: 'status-present' },
      { value: 'ขาด', label: 'ขาด', color: 'status-absent' },
      { value: 'สาย', label: 'สาย', color: 'status-late' },
      { value: 'ลาป่วย', label: 'ลาป่วย', color: 'status-sick' },
      { value: 'ลากิจ', label: 'ลากิจ', color: 'status-leave' },
    ];

    // ====== Utilities ======
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // ====== App ======
    function App() {
      const [user, setUser] = React.useState(() => {
        const raw = localStorage.getItem('csk_user');
        return raw ? JSON.parse(raw) : null;
      });
      const [currentPage, setCurrentPage] = React.useState(user ? 'attendance' : 'login');

      const handleLogout = () => {
        localStorage.removeItem('csk_user');
        setUser(null);
        setCurrentPage('login');
      };

      return (
        <div className="min-h-screen flex flex-col">
          {user && (
            <Header
              user={user}
              onLogout={handleLogout}
              setCurrentPage={setCurrentPage}
              currentPage={currentPage}
            />
          )}

          <main className="flex-grow container mx-auto px-4 py-6">
            {!user && (
              <LoginPage
                onLoggedIn={(u) => {
                  localStorage.setItem('csk_user', JSON.stringify(u));
                  setUser(u);
                  setCurrentPage('attendance');
                }}
              />
            )}

            {user && currentPage === 'attendance' && <AttendancePage />}
            {user && currentPage === 'students' && <StudentsPage />}
            {user && currentPage === 'reports' && <ReportsPage />}
          </main>

          <Footer />
        </div>
      );
    }

    // ====== Header ======
    function Header({ user, onLogout, setCurrentPage, currentPage }) {
      return (
        <header className="bg-white shadow-md">
          <div className="container mx-auto px-4 py-3">
            <div className="flex flex-col md:flex-row justify-between items-center">
              <div className="flex items-center mb-4 md:mb-0">
                <img
                  src="https://img2.pic.in.th/pic/IMG_1972-removebg-preview.png"
                  alt="โลโก้โรงเรียน"
                  className="h-12 mr-3"
                />
                <h1 className="text-xl font-bold text-primary">ระบบเช็คชื่อกิจกรรมหน้าเสาธง</h1>
              </div>

              <div className="flex flex-col md:flex-row items-center">
                <div className="text-sm text-gray-600 mr-4 mb-2 md:mb-0">
                  สวัสดี, {user.displayName || user.email}
                </div>

                <nav className="flex space-x-1 mb-2 md:mb-0">
                  <button
                    onClick={() => setCurrentPage('attendance')}
                    className={`px-3 py-1 rounded-md text-sm ${currentPage === 'attendance' ? 'bg-primary-light text-primary font-medium' : 'text-gray-600 hover:bg-gray-100'}`}
                  >
                    เช็คชื่อ
                  </button>
                  <button
                    onClick={() => setCurrentPage('students')}
                    className={`px-3 py-1 rounded-md text-sm ${currentPage === 'students' ? 'bg-primary-light text-primary font-medium' : 'text-gray-600 hover:bg-gray-100'}`}
                  >
                    จัดการนักเรียน
                  </button>
                  <button
                    onClick={() => setCurrentPage('reports')}
                    className={`px-3 py-1 rounded-md text-sm ${currentPage === 'reports' ? 'bg-primary-light text-primary font-medium' : 'text-gray-600 hover:bg-gray-100'}`}
                  >
                    รายงาน
                  </button>
                </nav>

                <button
                  onClick={onLogout}
                  className="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md text-sm text-gray-700 transition"
                >
                  ออกจากระบบ
                </button>
              </div>
            </div>
          </div>
        </header>
      );
    }

    // ====== Footer ======
    function Footer() {
      return (
        <footer className="bg-gray-800 text-white py-4">
          <div className="container mx-auto px-4 text-center text-sm">
            ครูก้องไง จะใครหละ | <a href="http://www.patompong.csk.ac.th" className="underline hover:text-secondary-light" target="_blank" rel="noopener noreferrer">www.patompong.csk.ac.th</a>
          </div>
        </footer>
      );
    }

    // ====== Login Page ======
    function LoginPage({ onLoggedIn }) {
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState('');
      const [isLoading, setIsLoading] = React.useState(false);

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setIsLoading(true);
        try {
          const profile = await api('login', { email, password });
          onLoggedIn(profile);
        } catch (err) {
          console.error(err);
          setError('อีเมลหรือรหัสผ่านไม่ถูกต้อง');
        } finally {
          setIsLoading(false);
        }
      };

      return (
        <div className="min-h-[80vh] flex items-center justify-center">
          <div className="bg-white p-8 rounded-lg shadow-lg w-full max-w-md fade-in">
            <div className="text-center mb-8">
              <img
                src="https://img2.pic.in.th/pic/IMG_1972-removebg-preview.png"
                alt="โลโก้โรงเรียน"
                className="h-24 mx-auto mb-4"
              />
              <h2 className="text-2xl font-bold text-primary">เข้าสู่ระบบเช็คชื่อกิจกรรมหน้าเสาธง</h2>
              <p className="text-gray-600 text-sm mt-1">สำหรับครูและบุคลากรทางการศึกษา</p>
            </div>

            {error && (
              <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
                {error}
              </div>
            )}

            <form onSubmit={handleLogin}>
              <div className="mb-4">
                <label htmlFor="email" className="block text-gray-700 text-sm font-medium mb-1">อีเมล</label>
                <input
                  type="email"
                  id="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  required
                />
              </div>

              <div className="mb-6">
                <label htmlFor="password" className="block text-gray-700 text-sm font-medium mb-1">รหัสผ่าน</label>
                <input
                  type="password"
                  id="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  required
                />
              </div>

              <button
                type="submit"
                disabled={isLoading}
                className="w-full btn-primary py-2 px-4 rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
              >
                {isLoading ? 'กำลังเข้าสู่ระบบ...' : 'เข้าสู่ระบบ'}
              </button>
            </form>
          </div>
        </div>
      );
    }

    // ====== Students Page ======
    function StudentsPage() {
      const [selectedRoom, setSelectedRoom] = React.useState(ROOMS[0].id);
      const [students, setStudents] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [textAreaInput, setTextAreaInput] = React.useState('');
      const [editingStudent, setEditingStudent] = React.useState(null);
      const [showModal, setShowModal] = React.useState(false);
      const [modalType, setModalType] = React.useState('');
      const [studentToDelete, setStudentToDelete] = React.useState(null);

      React.useEffect(() => { loadStudents(); }, [selectedRoom]);

      const loadStudents = async () => {
        setLoading(true);
        try {
          const list = await api('getStudents', { roomId: selectedRoom });
          setStudents(list.map(s => ({ id: s.studentId, ...s })));
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถโหลดข้อมูลนักเรียนได้");
        } finally {
          setLoading(false);
        }
      };

      const handleAddFromTextArea = () => {
        if (!textAreaInput.trim()) { alert("กรุณาป้อนข้อมูลนักเรียน"); return; }
        const lines = textAreaInput.trim().split('\n');
        const newStudents = [];
        for (const line of lines) {
          const parts = line.split('\t');
          if (parts.length < 4) continue;
          newStudents.push({
            studentId: parts[0].trim(),
            prefix: parts[1].trim(),
            firstName: parts[2].trim(),
            lastName: parts[3].trim()
          });
        }
        if (newStudents.length === 0) { alert("ไม่พบข้อมูลนักเรียนที่ถูกต้อง"); return; }
        saveStudents(newStudents);
      };

      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          try {
            const data = new Uint8Array(ev.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            if (jsonData.length === 0) { alert("ไม่พบข้อมูลในไฟล์ Excel"); return; }
            const newStudents = jsonData.map(row => ({
              studentId: String(row.studentId || row.รหัสนักเรียน || ''),
              prefix: String(row.prefix || row.คำนำหน้า || ''),
              firstName: String(row.firstName || row.ชื่อ || ''),
              lastName: String(row.lastName || row.นามสกุล || '')
            }));
            saveStudents(newStudents);
          } catch (err) {
            console.error(err);
            alert("เกิดข้อผิดพลาดในการอ่านไฟล์ Excel");
          }
        };
        reader.readAsArrayBuffer(file);
      };

      const saveStudents = async (newStudents) => {
        setLoading(true);
        try {
          await api('saveStudents', { roomId: selectedRoom, students: newStudents });
          setTextAreaInput('');
          await loadStudents();
          alert(`เพิ่มข้อมูลนักเรียนจำนวน ${newStudents.length} คนสำเร็จ`);
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถบันทึกข้อมูลนักเรียนได้");
        } finally {
          setLoading(false);
        }
      };

      const handleEditStudent = (student) => {
        setEditingStudent({ ...student });
        setModalType('edit');
        setShowModal(true);
      };

      const handleDeleteConfirm = (student) => {
        setStudentToDelete(student);
        setModalType('delete');
        setShowModal(true);
      };

      const handleDeleteStudent = async () => {
        if (!studentToDelete) return;
        setLoading(true);
        try {
          await api('deleteStudent', { roomId: selectedRoom, studentId: studentToDelete.id });
          setShowModal(false);
          setStudentToDelete(null);
          await loadStudents();
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถลบข้อมูลนักเรียนได้");
        } finally {
          setLoading(false);
        }
      };

      const handleSaveEdit = async () => {
        if (!editingStudent) return;
        setLoading(true);
        try {
          await api('updateStudent', {
            roomId: selectedRoom,
            student: {
              studentId: editingStudent.studentId,
              prefix: editingStudent.prefix,
              firstName: editingStudent.firstName,
              lastName: editingStudent.lastName
            }
          });
          setShowModal(false);
          setEditingStudent(null);
          await loadStudents();
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถอัปเดตข้อมูลนักเรียนได้");
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="fade-in">
          <h2 className="text-2xl font-bold mb-6 text-primary">จัดการข้อมูลนักเรียน</h2>

          <div className="mb-6">
            <label className="block text-gray-700 font-medium mb-2">เลือกห้องเรียน</label>
            <select
              value={selectedRoom}
              onChange={(e) => setSelectedRoom(e.target.value)}
              className="w-full md:w-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            >
              {ROOMS.map((room) => (
                <option key={room.id} value={room.id}>{room.name}</option>
              ))}
            </select>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div className="bg-white p-6 rounded-lg shadow-md">
              <h3 className="text-lg font-semibold mb-4 text-primary">เพิ่มนักเรียนจาก Text</h3>
              <p className="text-sm text-gray-600 mb-2">
                รูปแบบ: รหัสนักเรียน[Tab]คำนำหน้า[Tab]ชื่อ[Tab]นามสกุล (1 คน/บรรทัด)
              </p>
              <textarea
                value={textAreaInput}
                onChange={(e) => setTextAreaInput(e.target.value)}
                className="w-full h-40 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent mb-4"
                placeholder="10001	เด็กชาย	สมชาย	ใจดี&#10;10002	เด็กหญิง	สมหญิง	รักเรียน"
              ></textarea>
              <button
                onClick={handleAddFromTextArea}
                disabled={loading}
                className="btn-primary py-2 px-4 rounded-md font-medium focus:outline-none"
              >
                {loading ? 'กำลังบันทึก...' : 'เพิ่มนักเรียน'}
              </button>
            </div>

            <div className="bg-white p-6 rounded-lg shadow-md">
              <h3 className="text-lg font-semibold mb-4 text-primary">เพิ่มนักเรียนจากไฟล์ Excel</h3>
              <p className="text-sm text-gray-600 mb-4">
                อัปโหลดไฟล์ Excel (.xlsx) ที่มีคอลัมน์: studentId, prefix, firstName, lastName
              </p>
              <div className="flex items-center justify-center w-full">
                <label className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                  <div className="flex flex-col items-center justify-center pt-5 pb-6">
                    <svg className="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <p className="mb-2 text-sm text-gray-500">
                      <span className="font-semibold">คลิกเพื่อเลือกไฟล์</span> หรือลากไฟล์มาวาง
                    </p>
                    <p className="text-xs text-gray-500">XLSX (ไม่เกิน 10MB)</p>
                  </div>
                  <input type="file" className="hidden" accept=".xlsx" onChange={handleFileUpload} disabled={loading} />
                </label>
              </div>
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow-md">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-semibold text-primary">รายชื่อนักเรียน {ROOMS.find(r => r.id === selectedRoom)?.name}</h3>
              <span className="text-sm text-gray-600">จำนวน {students.length} คน</span>
            </div>

            {loading ? (
              <div className="text-center py-8">
                <div className="animate-spin rounded-full h-10 w-10 border-t-4 border-b-4 border-primary mx-auto"></div>
                <p className="mt-2 text-gray-600">กำลังโหลดข้อมูล...</p>
              </div>
            ) : students.length === 0 ? (
              <div className="text-center py-8 text-gray-500">ไม่พบข้อมูลนักเรียนในห้องเรียนนี้</div>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รหัสนักเรียน</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                      <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">จัดการ</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {students.map((student) => (
                      <tr key={student.id} className="hover:bg-gray-50">
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{student.studentId}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {student.prefix} {student.firstName} {student.lastName}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <button onClick={() => handleEditStudent(student)} className="text-primary hover:text-primary-dark mr-3">แก้ไข</button>
                          <button onClick={() => handleDeleteConfirm(student)} className="text-red-600 hover:text-red-800">ลบ</button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>

          {/* Modal for Edit/Delete */}
          {showModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-xl w-full max-w-md slide-in">
                {modalType === 'edit' && (
                  <>
                    <div className="p-6">
                      <h3 className="text-lg font-semibold mb-4">แก้ไขข้อมูลนักเรียน</h3>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">รหัสนักเรียน</label>
                          <input type="text" value={editingStudent?.studentId || ''} onChange={(e) => setEditingStudent({...editingStudent, studentId: e.target.value})} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">คำนำหน้า</label>
                          <input type="text" value={editingStudent?.prefix || ''} onChange={(e) => setEditingStudent({...editingStudent, prefix: e.target.value})} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">ชื่อ</label>
                          <input type="text" value={editingStudent?.firstName || ''} onChange={(e) => setEditingStudent({...editingStudent, firstName: e.target.value})} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">นามสกุล</label>
                          <input type="text" value={editingStudent?.lastName || ''} onChange={(e) => setEditingStudent({...editingStudent, lastName: e.target.value})} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" />
                        </div>
                      </div>
                    </div>
                    <div className="bg-gray-50 px-6 py-3 flex justify-end space-x-2 rounded-b-lg">
                      <button onClick={() => setShowModal(false)} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-800">ยกเลิก</button>
                      <button onClick={handleSaveEdit} disabled={loading} className="px-4 py-2 btn-primary rounded-md">{loading ? 'กำลังบันทึก...' : 'บันทึก'}</button>
                    </div>
                  </>
                )}
                {modalType === 'delete' && (
                  <>
                    <div className="p-6">
                      <h3 className="text-lg font-semibold mb-2">ยืนยันการลบข้อมูล</h3>
                      <p className="text-gray-700">คุณต้องการลบข้อมูลของ {studentToDelete?.prefix} {studentToDelete?.firstName} {studentToDelete?.lastName} ใช่หรือไม่?</p>
                    </div>
                    <div className="bg-gray-50 px-6 py-3 flex justify-end space-x-2 rounded-b-lg">
                      <button onClick={() => setShowModal(false)} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-800">ยกเลิก</button>
                      <button onClick={handleDeleteStudent} disabled={loading} className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md">{loading ? 'กำลังลบ...' : 'ลบข้อมูล'}</button>
                    </div>
                  </>
                )}
              </div>
            </div>
          )}
        </div>
      );
    }

    // ====== Attendance Page ======
    function AttendancePage() {
      const [selectedRoom, setSelectedRoom] = React.useState(ROOMS[0].id);
      const [selectedDate, setSelectedDate] = React.useState(formatDate(new Date()));
      const [students, setStudents] = React.useState([]);
      const [attendanceData, setAttendanceData] = React.useState({});
      const [loading, setLoading] = React.useState(false);
      const [saving, setSaving] = React.useState(false);
      const [showHistoryModal, setShowHistoryModal] = React.useState(false);
      const [selectedStudent, setSelectedStudent] = React.useState(null);
      const [studentHistory, setStudentHistory] = React.useState([]);
      const [historyLoading, setHistoryLoading] = React.useState(false);

      React.useEffect(() => { loadData(); }, [selectedRoom, selectedDate]);

      async function loadData() {
        setLoading(true);
        try {
          const list = await api('getStudents', { roomId: selectedRoom });
          setStudents(list.map(s => ({ id: s.studentId, ...s })));
          const att = await api('getAttendance', { date: selectedDate, roomId: selectedRoom });
          setAttendanceData(att);
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถโหลดข้อมูลได้");
        } finally {
          setLoading(false);
        }
      }

      const handleStatusChange = (studentId, status) => {
        setAttendanceData(prev => ({ ...prev, [studentId]: { ...prev[studentId], status } }));
      };

      const handleRemarkChange = (studentId, remark) => {
        setAttendanceData(prev => ({ ...prev, [studentId]: { ...prev[studentId], remark } }));
      };

      const handleSetAllStatus = (status) => {
        const newData = {};
        students.forEach(student => { newData[student.id] = { ...(attendanceData[student.id]||{}), status }; });
        setAttendanceData(newData);
      };

      const handleClearAll = () => setAttendanceData({});

      const handleSaveAttendance = async () => {
        setSaving(true);
        try {
          const records = students.map(st => {
            const data = attendanceData[st.id] || {};
            return { studentId: st.id, status: data.status || 'ขาด', remark: data.remark || '' };
          });
          await api('saveAttendance', { date: selectedDate, roomId: selectedRoom, records });
          alert("บันทึกข้อมูลการเช็คชื่อเรียบร้อยแล้ว");
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถบันทึกข้อมูลการเช็คชื่อได้");
        } finally {
          setSaving(false);
        }
      };

      const handleViewHistory = async (student) => {
        setSelectedStudent(student);
        setHistoryLoading(true);
        setShowHistoryModal(true);
        try {
          const history = await api('getHistory', { roomId: selectedRoom, studentId: student.id, days: 30 });
          setStudentHistory(history);
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถโหลดประวัติการเข้าเรียนได้");
        } finally {
          setHistoryLoading(false);
        }
      };

      return (
        <div className="fade-in">
          <h2 className="text-2xl font-bold mb-6 text-primary">เช็คชื่อกิจกรรมหน้าเสาธง</h2>

          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label className="block text-gray-700 font-medium mb-2">เลือกห้องเรียน</label>
                <select value={selectedRoom} onChange={(e) => setSelectedRoom(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                  {ROOMS.map((room) => (<option key={room.id} value={room.id}>{room.name}</option>))}
                </select>
              </div>
              <div>
                <label className="block text-gray-700 font-medium mb-2">เลือกวันที่</label>
                <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/>
              </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
              <button onClick={() => handleSetAllStatus('มา')} className="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded-md text-sm">มาทั้งหมด</button>
              <button onClick={() => handleSetAllStatus('ขาด')} className="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded-md text-sm">ขาดทั้งหมด</button>
              <button onClick={handleClearAll} className="px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded-md text-sm">ล้างค่า</button>
            </div>
          </div>

          <div className="bg-white rounded-lg shadow-md overflow-hidden">
            <div className="p-4 bg-gray-50 border-b flex justify-between items-center">
              <h3 className="font-semibold text-primary">รายชื่อนักเรียน {ROOMS.find(r => r.id === selectedRoom)?.name}</h3>
              <button onClick={handleSaveAttendance} disabled={saving || loading} className="btn-primary py-1 px-4 rounded-md text-sm">
                {saving ? 'กำลังบันทึก...' : 'บันทึกการเช็คชื่อ'}
              </button>
            </div>

            {loading ? (
              <div className="text-center py-8">
                <div className="animate-spin rounded-full h-10 w-10 border-t-4 border-b-4 border-primary mx-auto"></div>
                <p className="mt-2 text-gray-600">กำลังโหลดข้อมูล...</p>
              </div>
            ) : students.length === 0 ? (
              <div className="text-center py-8 text-gray-500">ไม่พบข้อมูลนักเรียนในห้องเรียนนี้</div>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รหัสนักเรียน</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หมายเหตุ</th>
                      <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ประวัติ</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {students.map((student) => (
                      <tr key={student.id} className="hover:bg-gray-50">
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{student.studentId}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{student.prefix} {student.firstName} {student.lastName}</td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <select
                            value={attendanceData[student.id]?.status || ''}
                            onChange={(e) => handleStatusChange(student.id, e.target.value)}
                            className={`px-3 py-1 border rounded-md text-sm ${
                              attendanceData[student.id]?.status === 'มา' ? 'status-present' :
                              attendanceData[student.id]?.status === 'ขาด' ? 'status-absent' :
                              attendanceData[student.id]?.status === 'สาย' ? 'status-late' :
                              attendanceData[student.id]?.status === 'ลาป่วย' ? 'status-sick' :
                              attendanceData[student.id]?.status === 'ลากิจ' ? 'status-leave' : ''
                            }`}
                          >
                            <option value="">-- เลือก --</option>
                            {STATUS_OPTIONS.map(option => (
                              <option key={option.value} value={option.value}>{option.label}</option>
                            ))}
                          </select>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <input
                            type="text"
                            value={attendanceData[student.id]?.remark || ''}
                            onChange={(e) => handleRemarkChange(student.id, e.target.value)}
                            placeholder="หมายเหตุ"
                            className="px-3 py-1 border border-gray-300 rounded-md text-sm w-full max-w-xs"
                          />
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-center">
                          <button onClick={() => handleViewHistory(student)} className="text-primary hover:text-primary-dark text-sm underline">ดูประวัติ</button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>

          {/* Student History Modal */}
          {showHistoryModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl slide-in">
                <div className="p-6">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold">
                      ประวัติการเข้าร่วมกิจกรรม: {selectedStudent?.prefix} {selectedStudent?.firstName} {selectedStudent?.lastName}
                    </h3>
                    <button onClick={() => setShowHistoryModal(false)} className="text-gray-500 hover:text-gray-700">✕</button>
                  </div>

                  {historyLoading ? (
                    <div className="text-center py-8">
                      <div className="animate-spin rounded-full h-10 w-10 border-t-4 border-b-4 border-primary mx-auto"></div>
                      <p className="mt-2 text-gray-600">กำลังโหลดประวัติ...</p>
                    </div>
                  ) : studentHistory.length === 0 ? (
                    <div className="text-center py-8 text-gray-500">ไม่พบประวัติการเข้าร่วมกิจกรรมในช่วง 30 วันที่ผ่านมา</div>
                  ) : (
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หมายเหตุ</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {studentHistory.map((record, index) => (
                            <tr key={index} className="hover:bg-gray-50">
                              <td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">
                                {new Date(record.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' })}
                              </td>
                              <td className="px-6 py-3 whitespace-nowrap">
                                <span className={`px-2 py-1 text-xs rounded-full ${
                                  record.status === 'มา' ? 'status-present' :
                                  record.status === 'ขาด' ? 'status-absent' :
                                  record.status === 'สาย' ? 'status-late' :
                                  record.status === 'ลาป่วย' ? 'status-sick' :
                                  record.status === 'ลากิจ' ? 'status-leave' : ''
                                }`}>
                                  {record.status}
                                </span>
                              </td>
                              <td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">{record.remark || '-'}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ====== Reports Page ======
    function ReportsPage() {
      const [selectedRoom, setSelectedRoom] = React.useState('all');
      const [reportType, setReportType] = React.useState('daily');
      const [startDate, setStartDate] = React.useState(formatDate(new Date()));
      const [endDate, setEndDate] = React.useState(formatDate(new Date()));
      const [reportData, setReportData] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const pieChartRef = React.useRef(null);
      const barChartRef = React.useRef(null);

      function getDateRange() {
        if (reportType === 'daily') { return [startDate]; }
        const start = new Date(startDate);
        const end = new Date(endDate);
        const dates = [];
        let currentDate = new Date(start);
        while (currentDate <= end) {
          dates.push(formatDate(currentDate));
          currentDate.setDate(currentDate.getDate() + 1);
        }
        return dates;
      }

      const generateReport = async () => {
        setLoading(true);
        try {
          const dates = getDateRange();
          const rooms = selectedRoom === 'all' ? ROOMS.map(r => r.id) : [selectedRoom];
          const report = {
            summary: { มา: 0, ขาด: 0, สาย: 0, ลาป่วย: 0, ลากิจ: 0, total: 0 },
            roomData: {},
            dateData: {},
            detailData: []
          };
          rooms.forEach(r => report.roomData[r] = { มา:0, ขาด:0, สาย:0, ลาป่วย:0, ลากิจ:0, total:0 });
          dates.forEach(d => report.dateData[d] = { มา:0, ขาด:0, สาย:0, ลาป่วย:0, ลากิจ:0, total:0 });

          for (const roomId of rooms) {
            const students = await api('getStudents', { roomId });
            for (const date of dates) {
              const att = await api('getAttendance', { date, roomId }); // object by studentId
              for (const st of students) {
                const rec = att[st.studentId] || { status: 'ขาด', remark: '' };
                const status = rec.status || 'ขาด';
                report.summary[status]++; report.summary.total++;
                report.roomData[roomId][status]++; report.roomData[roomId].total++;
                report.dateData[date][status]++; report.dateData[date].total++;
                report.detailData.push({
                  date,
                  roomId,
                  roomName: ROOMS.find(r => r.id === roomId)?.name || '',
                  studentId: st.studentId,
                  studentName: `${st.prefix} ${st.firstName} ${st.lastName}`,
                  status,
                  remark: rec.remark || ''
                });
              }
            }
          }

          setReportData(report);
          setTimeout(() => { createPieChart(report.summary); createBarChart(report); }, 50);
        } catch (error) {
          console.error(error);
          alert("ไม่สามารถสร้างรายงานได้");
        } finally {
          setLoading(false);
        }
      };

      const createPieChart = (data) => {
        if (!pieChartRef.current) return;
        if (pieChartRef.current.chart) pieChartRef.current.chart.destroy();
        const ctx = pieChartRef.current.getContext('2d');
        pieChartRef.current.chart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['มา', 'ขาด', 'สาย', 'ลาป่วย', 'ลากิจ'],
            datasets: [{
              data: [data.มา, data.ขาด, data.สาย, data.ลาป่วย, data.ลากิจ],
              backgroundColor: ['#98FB98', '#FFA07A', '#FFFF99', '#ADD8E6', '#DDA0DD'],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    const percentage = data.total ? Math.round((value / data.total) * 100) : 0;
                    return `${label}: ${value} คน (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      };

      const createBarChart = (data) => {
        if (!barChartRef.current) return;
        if (barChartRef.current.chart) barChartRef.current.chart.destroy();
        const ctx = barChartRef.current.getContext('2d');

        let labels, datasets;
        if (selectedRoom === 'all') {
          labels = ROOMS.map(room => room.name);
          datasets = [
            { label: 'มา',     data: ROOMS.map(r => data.roomData[r.id]?.มา || 0),     backgroundColor: '#98FB98' },
            { label: 'ขาด',    data: ROOMS.map(r => data.roomData[r.id]?.ขาด || 0),    backgroundColor: '#FFA07A' },
            { label: 'สาย',    data: ROOMS.map(r => data.roomData[r.id]?.สาย || 0),    backgroundColor: '#FFFF99' },
            { label: 'ลาป่วย', data: ROOMS.map(r => data.roomData[r.id]?.ลาป่วย || 0), backgroundColor: '#ADD8E6' },
            { label: 'ลากิจ',  data: ROOMS.map(r => data.roomData[r.id]?.ลากิจ || 0),  backgroundColor: '#DDA0DD' },
          ];
        } else {
          const dates = Object.keys(data.dateData).sort();
          labels = dates.map(date => {
            const d = new Date(date);
            return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
          });
          datasets = [
            { label: 'มา',     data: dates.map(d => data.dateData[d]?.มา || 0),     backgroundColor: '#98FB98' },
            { label: 'ขาด',    data: dates.map(d => data.dateData[d]?.ขาด || 0),    backgroundColor: '#FFA07A' },
            { label: 'สาย',    data: dates.map(d => data.dateData[d]?.สาย || 0),    backgroundColor: '#FFFF99' },
            { label: 'ลาป่วย', data: dates.map(d => data.dateData[d]?.ลาป่วย || 0), backgroundColor: '#ADD8E6' },
            { label: 'ลากิจ',  data: dates.map(d => data.dateData[d]?.ลากิจ || 0),  backgroundColor: '#DDA0DD' },
          ];
        }

        barChartRef.current.chart = new Chart(ctx, {
          type: 'bar',
          data: { labels, datasets },
          options: {
            responsive: true,
            scales: {
              x: { stacked: true },
              y: { stacked: true, beginAtZero: true }
            },
            plugins: { legend: { position: 'bottom' } }
          }
        });
      };

      return (
        <div className="fade-in">
          <h2 className="text-2xl font-bold mb-6 text-primary">รายงานการเข้าร่วมกิจกรรม</h2>

          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
              <div>
                <label className="block text-gray-700 font-medium mb-2">ห้องเรียน</label>
                <select value={selectedRoom} onChange={(e) => setSelectedRoom(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                  <option value="all">ทั้งโรงเรียน</option>
                  {ROOMS.map((room) => (<option key={room.id} value={room.id}>{room.name}</option>))}
                </select>
              </div>

              <div>
                <label className="block text-gray-700 font-medium mb-2">ประเภทรายงาน</label>
                <select value={reportType} onChange={(e) => setReportType(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                  <option value="daily">รายวัน</option>
                  <option value="weekly">รายสัปดาห์</option>
                </select>
              </div>

              <div>
                <label className="block text-gray-700 font-medium mb-2">{reportType === 'daily' ? 'วันที่' : 'วันที่เริ่มต้น'}</label>
                <input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/>
              </div>

              {reportType === 'weekly' && (
                <div>
                  <label className="block text-gray-700 font-medium mb-2">วันที่สิ้นสุด</label>
                  <input type="date" value={endDate} onChange={(e) => setEndDate(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/>
                </div>
              )}
            </div>

            <button onClick={generateReport} disabled={loading} className="btn-primary py-2 px-4 rounded-md font-medium focus:outline-none">
              {loading ? 'กำลังสร้างรายงาน...' : 'สร้างรายงาน'}
            </button>
          </div>

          {loading ? (
            <div className="text-center py-8">
              <div className="animate-spin rounded-full h-10 w-10 border-t-4 border-b-4 border-primary mx-auto"></div>
              <p className="mt-2 text-gray-600">กำลังสร้างรายงาน...</p>
            </div>
          ) : reportData && (
            <div className="space-y-6">
              <div className="bg-white p-6 rounded-lg shadow-md">
                <h3 className="text-lg font-semibold mb-4 text-primary">สรุปภาพรวม</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <div className="bg-gray-50 p-4 rounded-lg">
                      <h4 className="font-medium mb-3 text-gray-700">สถิติการเข้าร่วมกิจกรรม</h4>
                      <div className="space-y-2">
                        {Object.entries(reportData.summary).filter(([k]) => k !== 'total').map(([status, count]) => (
                          <div key={status} className="flex justify-between items-center">
                            <div className="flex items-center">
                              <span className={`inline-block w-3 h-3 rounded-full mr-2 ${
                                status === 'มา' ? 'bg-green-400' :
                                status === 'ขาด' ? 'bg-red-400' :
                                status === 'สาย' ? 'bg-yellow-400' :
                                status === 'ลาป่วย' ? 'bg-blue-300' :
                                status === 'ลากิจ' ? 'bg-purple-300' : ''
                              }`}></span>
                              <span>{status}</span>
                            </div>
                            <div className="flex items-center">
                              <span className="font-medium">{count}</span>
                              <span className="text-gray-500 text-sm ml-1">
                                ({reportData.summary.total ? Math.round((count / reportData.summary.total) * 100) : 0}%)
                              </span>
                            </div>
                          </div>
                        ))}
                        <div className="border-t pt-2 mt-2 flex justify-between font-medium">
                          <span>รวมทั้งหมด</span>
                          <span>{reportData.summary.total} คน</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div><canvas ref={pieChartRef} height="200"></canvas></div>
                </div>
              </div>

              <div className="bg-white p-6 rounded-lg shadow-md">
                <h3 className="text-lg font-semibold mb-4 text-primary">
                  {selectedRoom === 'all' ? 'เปรียบเทียบรายห้องเรียน' : 'เปรียบเทียบรายวัน'}
                </h3>
                <div className="h-64">
                  <canvas ref={barChartRef}></canvas>
                </div>
              </div>

              <div className="bg-white p-6 rounded-lg shadow-md">
                <h3 className="text-lg font-semibold mb-4 text-primary">รายละเอียดข้อมูล</h3>
                <div className="overflow-x-auto">
                  <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่</th>
                        {selectedRoom === 'all' && (<th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ห้องเรียน</th>)}
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รหัสนักเรียน</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หมายเหตุ</th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      {reportData.detailData.map((record, index) => (
                        <tr key={index} className="hover:bg-gray-50">
                          <td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">
                            {new Date(record.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' })}
                          </td>
                          {selectedRoom === 'all' && (<td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">{record.roomName}</td>)}
                          <td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">{record.studentId}</td>
                          <td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">{record.studentName}</td>
                          <td className="px-6 py-3 whitespace-nowrap">
                            <span className={`px-2 py-1 text-xs rounded-full ${
                              record.status === 'มา' ? 'status-present' :
                              record.status === 'ขาด' ? 'status-absent' :
                              record.status === 'สาย' ? 'status-late' :
                              record.status === 'ลาป่วย' ? 'status-sick' :
                              record.status === 'ลากิจ' ? 'status-leave' : ''
                            }`}>{record.status}</span>
                          </td>
                          <td className="px-6 py-3 whitespace-nowrap text-sm text-gray-900">{record.remark || '-'}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ====== Render ======
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
